<project
   xmlns:j="jelly:core"
   xmlns:ant="jelly:ant"
   xmlns:artifact="artifact"
   xmlns:maven="jelly:maven">

    <goal name="war">
	    <echo>The "war" goal is deprecated. Use "multiwar:multiwar" instead.</echo>
    </goal>
    
    <goal name="war:war">
	    <echo>The "war" goal is deprecated. Use "multiwar:multiwar" instead.</echo>
    </goal>

    <goal name="multiwar:multiwar">
    	<!-- needed otherwise first custom artifact (cas) doesn't get built) -->
        <attainGoal name="acegisecurity:war"/>

        <!-- cas war -->
        <j:set var="webapp" value="cas"/>
        <attainGoal name="acegisecurity:war"/>

        <!-- ca war -->
        <j:set var="webapp" value="ca"/>
        <attainGoal name="acegisecurity:war"/>

        <!-- filter war -->
        <j:set var="webapp" value="filter"/>
        <attainGoal name="acegisecurity:war"/>

        <!-- x509 war -->
        <j:set var="webapp" value="x509"/>
        <attainGoal name="acegisecurity:war"/>

        <!-- ldap war -->
        <j:set var="webapp" value="ldap"/>
        <attainGoal name="acegisecurity:war"/>
				
		<!-- delete generic artifact (we only want our three custom WARs) -->
	    <ant:delete file="${maven.war.build.dir}/${pom.artifactId}.war"/>
    </goal>
    
    <goal name="acegisecurity:war">
        <maven:set plugin="maven-war-plugin"
            property="maven.war.webapp.dir"
            value="${maven.war.build.dir}/${pom.artifactId}-${webapp}"/>
        <maven:set plugin="maven-war-plugin"
            property="maven.war.final.name"
            value="${pom.artifactId}-${webapp}.war"/>
        <attainGoal name="war:war"/>
    </goal>

    <goal name="multiwar:install">
        <attainGoal name="multiwar:multiwar"/>
        <echo>multiproject:install doesn't install Contacts Samples WARs to local repo</echo>
    </goal>

    <postGoal name="war:war-resources">
        <maven:get plugin="maven-war-plugin"
            property="maven.war.webapp.dir"
            var="maven.war.webapp.dir"/>
        <ant:copy todir="${maven.war.webapp.dir}" preservelastmodified="true">
            <ant:fileset dir="${maven.war.src}/../${webapp}"/>
        </ant:copy>
    </postGoal>

	<goal name="run" prereqs="java:compile,java:jar-resources">
		<ant:java dir="client" classname="sample.contact.ClientApplication" fork="true" >
			<ant:sysproperty key="username" value="${username}"/>
			<ant:sysproperty key="password" value="${password}"/>
			<ant:sysproperty key="nrOfCalls" value="${nrOfCalls}"/>
			<ant:classpath>
				<ant:path refid="maven.dependency.classpath"/>
				<ant:pathelement path="${maven.build.dest} "/>
			</ant:classpath>
		</ant:java>
	</goal>

</project>
